<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Humble Key Formatter</title>
  <style>
    :root { --bg:#000000; --card:#070b10; --muted:#9db4c8; --text:#eaf4ff; --accent:#6bb6ff; --accent-2:#2a80ff; }
    * { box-sizing: border-box; }
    html,body { height: 100%; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: #000; color: var(--text); }
    body::before{ /* soft animated blue aura */
      content:""; position:fixed; inset:-20vmax; pointer-events:none;
      background: radial-gradient(30vmax 20vmax at 85% -10%, rgba(38,119,255,.25), transparent 60%),
                  radial-gradient(22vmax 16vmax at 10% 110%, rgba(38,119,255,.18), transparent 60%);
      filter: blur(40px) saturate(120%);
      animation: drift 18s ease-in-out infinite alternate;
      z-index:-1;
    }
    @keyframes drift { from { transform: translate3d(-2%, -1%, 0) scale(1); } to { transform: translate3d(2%, 1%, 0) scale(1.03); } }

    .wrap { max-width: 980px; margin: 40px auto; padding: 0 16px; }
    h1 { font-size: 1.6rem; margin: 0 0 10px; letter-spacing: .3px; }

    .card { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
            border: 1px solid rgba(255,255,255,.06); border-radius: 18px;
            box-shadow: 0 10px 40px rgba(0,0,0,.6), 0 0 0 1px rgba(107,182,255,.04) inset;
            overflow: hidden; backdrop-filter: blur(6px); animation: popin .6s ease-out; }
    @keyframes popin { from { transform: translateY(8px) scale(.98); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

    .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 900px){ .grid { grid-template-columns: 1fr 1fr; } }

    textarea, pre { width: 100%; height: 420px; padding: 14px 16px; resize: vertical; font: 12.5px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; border: 1px solid rgba(255,255,255,.06); border-radius: 14px; background: #020305; color: var(--text); outline: none; transition: border-color .25s ease, box-shadow .25s ease, transform .1s ease; }
    textarea:focus { border-color: rgba(107,182,255,.65); box-shadow: 0 0 0 3px rgba(42,128,255,.25), 0 10px 30px rgba(0,0,0,.45); transform: translateY(-1px); }
    pre { white-space: pre-wrap; word-break: break-word; background: #03060b; position: relative; }
    pre::after{ content:""; position:absolute; inset:0; pointer-events:none; background:
      linear-gradient(90deg, rgba(42,128,255,.06), transparent 20%, transparent 80%, rgba(42,128,255,.06));
      opacity:0; transition: opacity .6s ease; }
    .highlight pre::after{ opacity:1; animation: shimmer 1.2s ease; }
    @keyframes shimmer { from{ background-position:-100% 0; } to{ background-position:200% 0; } }

    .controls { display:flex; flex-wrap: wrap; gap: 8px 14px; align-items: center; padding: 12px 16px; border-top: 1px solid rgba(255,255,255,.06); background: rgba(12,18,26,.6); }

    .btn { position:relative; padding: 10px 14px; border-radius: 12px; border: 1px solid rgba(107,182,255,.35);
           background: linear-gradient(180deg, rgba(42,128,255,.25), rgba(42,128,255,.15)); color: var(--text);
           cursor: pointer; font-weight: 700; letter-spacing: .2px; transition: transform .12s ease, box-shadow .25s ease, filter .25s ease; }
    .btn::before{ content:""; position:absolute; inset:-2px; border-radius:14px; background: radial-gradient(60% 60% at 50% -20%, rgba(107,182,255,.6), transparent 60%); filter: blur(12px); opacity:.45; z-index:-1; transition: opacity .25s ease; }
    .btn:hover { box-shadow: 0 10px 30px rgba(42,128,255,.25); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); filter: brightness(.96); }

    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.12); background: rgba(12,18,26,.9); font-size: 12px; color: var(--muted); transition: border-color .25s ease, background .25s ease; }
    .pill:hover { border-color: rgba(107,182,255,.45); background: rgba(12,18,26,1); }
    .pill input { accent-color: var(--accent); }

    .hint { color: var(--muted); font-size: 12px; }
    .header { display:flex; justify-content: space-between; align-items: end; gap: 16px; margin-bottom: 12px; }
    .footer { margin-top: 12px; color: var(--muted); font-size: 12px; }
    .small { font-size: 11.5px; color: var(--muted); }
    .kbd { border: 1px solid rgba(255,255,255,.16); background: rgba(255,255,255,.06); border-radius: 6px; padding: 2px 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .row { display: grid; grid-template-columns: 1fr; gap: 14px; padding: 16px; }
    @media (min-width: 900px){ .row { grid-template-columns: 1fr 1fr; } }
    .sr { position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden; }

    .pulseGlow { box-shadow: 0 0 0 0 rgba(42,128,255,.45); animation: pulse 1.8s ease-out 2; }
    @keyframes pulse { 0%{ box-shadow: 0 0 0 0 rgba(42,128,255,.55);} 70%{ box-shadow: 0 0 0 18px rgba(42,128,255,0);} 100%{ box-shadow: 0 0 0 0 rgba(42,128,255,0);} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>Humble Key Formatter → <span class="small">Steam style</span></h1>
        <div class="hint">Paste your Humble Bundle page text on the left. The right side will output <code>KEY | Title</code> pairs. Works fully client‑side (no uploads).</div>
      </div>
      <button id="exampleBtn" class="btn" title="Load example">Load example</button>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label class="sr" for="input">Input</label>
          <textarea id="input" placeholder="Paste Humble keys block here…"></textarea>
        </div>
        <div>
          <label class="sr" for="output">Output</label>
          <pre id="output" aria-live="polite"></pre>
        </div>
      </div>
      <div class="controls">
        <button id="copyBtn" class="btn">Copy output</button>
        <button id="downloadBtn" class="btn">Download .txt</button>
        <label class="pill"><input id="dedupe" type="checkbox" checked /> Remove duplicates</label>
        <label class="pill"><input id="sort" type="checkbox" /> Sort A→Z by title</label>
        <label class="pill"><input id="steamOnly" type="checkbox" checked /> Strict Steam key format (5-5-5)</label>
        <span class="hint">Tip: paste with <span class="kbd">Ctrl</span>+<span class="kbd">V</span>. Parsing is automatic.</span>
      </div>
    </div>

    <div class="footer">
      <div>Regex covers <em>XXXXX-XXXXX-XXXXX</em> keys. Title is taken from the nearest non-empty line above the key, skipping “Redeem”/warnings.</div>
    </div>
  </div>

  <script>
    (function(){
      const elIn = document.getElementById('input');
      const elOut = document.getElementById('output');
      const elCopy = document.getElementById('copyBtn');
      const elDownload = document.getElementById('downloadBtn');
      const elDedupe = document.getElementById('dedupe');
      const elSort = document.getElementById('sort');
      const elStrict = document.getElementById('steamOnly');
      const elExample = document.getElementById('exampleBtn');
      const card = document.querySelector('.card');

      const WARNING = 'Steam will not provide extra giftable copies of games you already own.';

      function parse(input){
        const lines = input.split(/\r?\n/).map(s => s.trim());
        const results = [];
        const keyRegexStrict = /^[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/;
        const keyRegexLoose = /^[A-Z0-9]{4,5}-[A-Z0-9]{4,5}-[A-Z0-9]{4,5}$/; // toggleable
        const keyRegex = elStrict.checked ? keyRegexStrict : keyRegexLoose;

        for(let i=0;i<lines.length;i++){
          const line = lines[i];
          if(!line) continue;
          if(!keyRegex.test(line)) continue;
          const key = line.toUpperCase();

          // find nearest usable title above the key
          let title = '';
          for(let j=i-1; j>=0; j--){
            const t = lines[j];
            if(!t) continue; // skip empty
            if(/^redeem$/i.test(t)) continue; // skip Redeem buttons
            if(t === WARNING) continue; // skip standard warning
            if(/^steam key$/i.test(t)) continue;
            title = t; break;
          }
          if(title){ results.push({ title, key }); }
        }

        // post-process: dedupe and sort
        let pairs = results.map(r => `${r.key} | ${r.title}`);
        if(elDedupe.checked){
          const seen = new Set();
          pairs = pairs.filter(line => (seen.has(line) ? false : (seen.add(line), true)));
        }
        if(elSort.checked){
          pairs.sort((a,b) => {
            const at = a.split(' | ').slice(1).join(' | ').toLowerCase();
            const bt = b.split(' | ').slice(1).join(' | ').toLowerCase();
            return at.localeCompare(bt);
          });
        }
        return pairs.join('\n');
      }

      function update(){
        elOut.textContent = parse(elIn.value);
        // output highlight animation
        elOut.parentElement.classList.add('highlight');
        setTimeout(()=>elOut.parentElement.classList.remove('highlight'), 700);
      }

      async function copyOutput(showToast=true){
        try{
          await navigator.clipboard.writeText(elOut.textContent || '');
          if(showToast) toast('Copied formatted keys');
        }catch{
          if(showToast) toast('Copy failed. Select and copy manually.');
        }
      }

      elIn.addEventListener('input', update);
      elDedupe.addEventListener('change', ()=>{update(); copyOutput(false);});
      elSort.addEventListener('change', ()=>{update(); copyOutput(false);});
      elStrict.addEventListener('change', ()=>{update(); copyOutput(false);});

      elCopy.addEventListener('click', copyOutput);

      elDownload.addEventListener('click', () => {
        const blob = new Blob([elOut.textContent || ''], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'keys.txt';
        document.body.appendChild(a); a.click(); a.remove();
        setTimeout(() => URL.revokeObjectURL(url), 1000);
      });

      elExample.addEventListener('click', () => {
        elIn.value = `Operation Wolf Returns: First Mission\n7M90A-LN00T-3W9WL\nRedeem\nSteam will not provide extra giftable copies of games you already own.\n\nAsterix & Obelix Slap them All! 2\n8FGY6-R2XBT-QZX20\nRedeem\nSteam will not provide extra giftable copies of games you already own.\n\nGrand Mountain Adventure: Wonderlands\n959PG-RA0RI-NRZYM\nRedeem\nSteam will not provide extra giftable copies of games you already own.`;
        update();
        copyOutput();
        pulse(card);
      });

      // Auto-parse and auto-copy on paste
      elIn.addEventListener('paste', () => setTimeout(async () => {
        update();
        const lines = (elOut.textContent || '').split(/\n/).filter(Boolean);
        await copyOutput(false);
        toast(`Auto-copied ${lines.length} line${lines.length===1?'':'s'}`);
        pulse(elOut);
      }, 0));

      function pulse(el){ el.classList.remove('pulseGlow'); void el.offsetWidth; el.classList.add('pulseGlow'); }

      // tiny toast
      function toast(msg){
        const t = document.createElement('div');
        t.textContent = msg;
        t.style.position='fixed'; t.style.right='16px'; t.style.bottom='16px';
        t.style.padding='10px 12px'; t.style.borderRadius='12px';
        t.style.background='linear-gradient(180deg, rgba(42,128,255,.9), rgba(42,128,255,.75))';
        t.style.color='white'; t.style.fontSize='12.5px';
        t.style.border='1px solid rgba(255,255,255,.18)'; t.style.zIndex=9999;
        t.style.boxShadow='0 10px 30px rgba(42,128,255,.35)';
        t.style.transform='translateY(10px)'; t.style.opacity='0';
        t.style.transition='transform .25s ease, opacity .25s ease';
        document.body.appendChild(t);
        requestAnimationFrame(()=>{ t.style.transform='translateY(0)'; t.style.opacity='1'; });
        setTimeout(()=>{ t.style.transform='translateY(10px)'; t.style.opacity='0'; setTimeout(()=>t.remove(), 250); },1600);
      }

      // initial
      update();
    })();
  </script>
</body>
</html>
